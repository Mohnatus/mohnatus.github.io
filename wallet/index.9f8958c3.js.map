{"mappings":"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","sources":["<anon>","src/script.js","src/js/db/index.js","src/js/db/constants.js","src/js/db/items.js","src/js/utils/notifier.js","src/js/db/periods.js","src/js/db/tags.js","src/js/state/index.js","src/js/view/itemForm.js","src/js/view/elements.js","src/js/view/items.js","src/js/view/periods.js","src/js/utils/date.js","src/js/view/tagForm.js","src/js/view/tags.js"],"sourcesContent":["(function () {\nconst $ede44c74e12b5991$export$3c22ff8b64b8f565 = \"wallet\";\nconst $ede44c74e12b5991$export$6a9022b4c5fcea02 = 4;\nconst $ede44c74e12b5991$export$ecb8b5d0fe61b71e = \"items\";\nconst $ede44c74e12b5991$export$1ccac7a1df77a4d0 = \"tags\";\nconst $ede44c74e12b5991$export$a0ecdc0caa7bc41f = \"periods\";\n\n\nlet $089dfe9f23c5cbcf$var$dbRequest;\nfunction $089dfe9f23c5cbcf$export$6fec604aa7293d0c(storeName, toWrite) {\n    let db = $089dfe9f23c5cbcf$var$dbRequest.result;\n    let transaction = db.transaction(storeName, toWrite ? \"readwrite\" : \"readonly\");\n    let store = transaction.objectStore(storeName);\n    return store;\n}\nfunction $089dfe9f23c5cbcf$var$getItems() {\n    return new Promise((resolve)=>{\n        const items = $089dfe9f23c5cbcf$export$6fec604aa7293d0c((0, $ede44c74e12b5991$export$ecb8b5d0fe61b71e));\n        const request = items.getAll();\n        request.onsuccess = function() {\n            const result = request.result;\n            resolve(result);\n        };\n    });\n}\nasync function $089dfe9f23c5cbcf$var$getTags() {\n    return new Promise((resolve)=>{\n        const tags = $089dfe9f23c5cbcf$export$6fec604aa7293d0c((0, $ede44c74e12b5991$export$1ccac7a1df77a4d0));\n        const request = tags.getAll();\n        request.onsuccess = function() {\n            const result = request.result;\n            resolve(result);\n        };\n    });\n}\nasync function $089dfe9f23c5cbcf$var$getPeriods() {\n    return new Promise((resolve)=>{\n        const periods = $089dfe9f23c5cbcf$export$6fec604aa7293d0c((0, $ede44c74e12b5991$export$a0ecdc0caa7bc41f));\n        const request = periods.getAll();\n        request.onsuccess = function() {\n            const result = request.result;\n            resolve(result);\n        };\n    });\n}\nasync function $089dfe9f23c5cbcf$export$28e7436902e0cf8b() {\n    return new Promise((resolve)=>{\n        $089dfe9f23c5cbcf$var$dbRequest = indexedDB.open((0, $ede44c74e12b5991$export$3c22ff8b64b8f565), (0, $ede44c74e12b5991$export$6a9022b4c5fcea02));\n        $089dfe9f23c5cbcf$var$dbRequest.onupgradeneeded = function() {\n            let db = $089dfe9f23c5cbcf$var$dbRequest.result;\n            if (!db.objectStoreNames.contains((0, $ede44c74e12b5991$export$ecb8b5d0fe61b71e))) db.createObjectStore((0, $ede44c74e12b5991$export$ecb8b5d0fe61b71e), {\n                keyPath: \"id\"\n            });\n            if (!db.objectStoreNames.contains((0, $ede44c74e12b5991$export$1ccac7a1df77a4d0))) db.createObjectStore((0, $ede44c74e12b5991$export$1ccac7a1df77a4d0), {\n                keyPath: \"id\"\n            });\n            if (!db.objectStoreNames.contains((0, $ede44c74e12b5991$export$a0ecdc0caa7bc41f))) db.createObjectStore((0, $ede44c74e12b5991$export$a0ecdc0caa7bc41f), {\n                keyPath: \"id\"\n            });\n        };\n        $089dfe9f23c5cbcf$var$dbRequest.onerror = function() {\n            console.error(\"DB ERROR\", $089dfe9f23c5cbcf$var$dbRequest.error);\n        };\n        $089dfe9f23c5cbcf$var$dbRequest.onsuccess = function() {\n            Promise.all([\n                $089dfe9f23c5cbcf$var$getTags(),\n                $089dfe9f23c5cbcf$var$getItems(),\n                $089dfe9f23c5cbcf$var$getPeriods()\n            ]).then(([tags, items, periods])=>{\n                resolve({\n                    tags: tags,\n                    items: items,\n                    periods: periods\n                });\n            });\n        };\n    });\n}\n\n\n\nfunction $3a628accdda08e87$export$5e14cdade93d6f7b(message, data) {\n    alert(message);\n    console.info(message, data);\n}\nfunction $3a628accdda08e87$export$740944ffd2f8d33e(message, data) {\n    alert(message);\n    console.error(message, data);\n}\n\n\n\nfunction $2e1c9c006365a309$export$d9965447fadaae35(item) {\n    const items = (0, $089dfe9f23c5cbcf$export$6fec604aa7293d0c)((0, $ede44c74e12b5991$export$ecb8b5d0fe61b71e), true);\n    let request = items.add(item);\n    request.onsuccess = function() {\n        (0, $3a628accdda08e87$export$5e14cdade93d6f7b)(\"Запись успешно сохранена\");\n    };\n    request.onerror = function() {\n        (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не удалось сохранить запись\", request.error);\n    };\n}\nfunction $2e1c9c006365a309$export$6d74f2e0bd134e69(item) {\n    let items = (0, $089dfe9f23c5cbcf$export$6fec604aa7293d0c)((0, $ede44c74e12b5991$export$ecb8b5d0fe61b71e), true);\n    let request = items.delete(item.id);\n    request.onsuccess = function() {\n        (0, $3a628accdda08e87$export$5e14cdade93d6f7b)(\"Запись успешно удалена\");\n    };\n    request.onerror = function() {\n        (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не удалось удалить запись\", request.error);\n    };\n}\n\n\n\n\n\nfunction $93ce6c7c933f1dfc$export$e2a0d46e1b66d1c3(period) {\n    const periods = (0, $089dfe9f23c5cbcf$export$6fec604aa7293d0c)((0, $ede44c74e12b5991$export$a0ecdc0caa7bc41f), true);\n    let request = periods.add(period);\n    request.onsuccess = function() {\n        (0, $3a628accdda08e87$export$5e14cdade93d6f7b)(\"Запись успешно сохранена\");\n    };\n    request.onerror = function() {\n        (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не удалось сохранить запись\", request.error);\n    };\n}\nfunction $93ce6c7c933f1dfc$export$713c4cdea7446c01(period) {\n    let periods = (0, $089dfe9f23c5cbcf$export$6fec604aa7293d0c)((0, $ede44c74e12b5991$export$a0ecdc0caa7bc41f), true);\n    let request = periods.delete(period.id);\n    request.onsuccess = function() {\n        (0, $3a628accdda08e87$export$5e14cdade93d6f7b)(\"Запись успешно удалена\");\n    };\n    request.onerror = function() {\n        (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не удалось удалить запись\", request.error);\n    };\n}\n\n\n\n\n\nfunction $eb7925e53eeaa87b$export$9136620570748e5(tag) {\n    let tags = (0, $089dfe9f23c5cbcf$export$6fec604aa7293d0c)((0, $ede44c74e12b5991$export$1ccac7a1df77a4d0), true);\n    let request = tags.add(tag);\n    request.onsuccess = function() {\n        (0, $3a628accdda08e87$export$5e14cdade93d6f7b)(\"Запись успешно сохранена\");\n    };\n    request.onerror = function() {\n        (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не удалось сохранить запись\", request.error);\n    };\n}\nfunction $eb7925e53eeaa87b$export$db24519f95b43085(tag) {\n    let tags = (0, $089dfe9f23c5cbcf$export$6fec604aa7293d0c)((0, $ede44c74e12b5991$export$1ccac7a1df77a4d0), true);\n    let request = tags.delete(tag.id);\n    request.onsuccess = function() {\n        (0, $3a628accdda08e87$export$5e14cdade93d6f7b)(\"Запись успешно удалена\");\n    };\n    request.onerror = function() {\n        (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не удалось удалить запись\", request.error);\n    };\n}\n\n\nconst $dc773e5000725a3f$export$4dbdc8f16fed8a34 = {\n    items: \"items\",\n    tags: \"tags\",\n    periods: \"periods\",\n    activePeriod: \"activePeriod\"\n};\nconst $dc773e5000725a3f$export$4bf9923669ad6c63 = {\n    update: \"update\",\n    add: \"add\",\n    remove: \"remove\"\n};\nconst $dc773e5000725a3f$var$state = {\n    items: [],\n    tags: [],\n    periods: [],\n    activePeriod: null\n};\nconst $dc773e5000725a3f$var$lastId = {\n    items: 0,\n    tags: 0,\n    periods: 0\n};\nconst $dc773e5000725a3f$var$callbacks = {};\nfunction $dc773e5000725a3f$export$50fdfeece43146fd(field) {\n    return $dc773e5000725a3f$var$state[field];\n}\nfunction $dc773e5000725a3f$export$438707edafd83667() {\n    const period = $dc773e5000725a3f$var$state.activePeriod;\n    if (!period) return $dc773e5000725a3f$var$state.items;\n    const periodIndex = $dc773e5000725a3f$var$state.periods.findIndex((p)=>p.id === period.id);\n    const nextPeriod = $dc773e5000725a3f$var$state.periods[periodIndex + 1];\n    console.log({\n        period: period,\n        periodIndex: periodIndex,\n        nextPeriod: nextPeriod,\n        periods: $dc773e5000725a3f$var$state.periods,\n        items: $dc773e5000725a3f$var$state.items\n    });\n    return $dc773e5000725a3f$var$state.items.filter((item)=>{\n        if (item.createdAt < period.createdAt) return false;\n        if (nextPeriod && item.createdAt >= nextPeriod.createdAt) return false;\n        return true;\n    });\n}\nfunction $dc773e5000725a3f$export$15b7d0c192d0aa5d() {\n    const items = [];\n    $dc773e5000725a3f$var$state.items.forEach((item)=>{\n        items.push(item);\n        items.push(...item.subitems);\n    });\n    return items;\n}\nfunction $dc773e5000725a3f$export$427b5ec03bdd7685() {\n    const items = $dc773e5000725a3f$export$15b7d0c192d0aa5d();\n    const weight = {};\n    $dc773e5000725a3f$var$state.tags.forEach((tag)=>{\n        weight[tag.id] = 0;\n    });\n    items.forEach((item)=>{\n        weight[item.tag] += 1;\n    });\n    return weight;\n}\nfunction $dc773e5000725a3f$export$218c8c3169c024d2(field) {\n    return ++$dc773e5000725a3f$var$lastId[field];\n}\nfunction $dc773e5000725a3f$var$onChange(field, event, data) {\n    const fieldCbs = $dc773e5000725a3f$var$callbacks[field];\n    if (!fieldCbs) return;\n    const eventCbs = fieldCbs[event];\n    if (!eventCbs) return;\n    eventCbs.forEach((cb)=>cb(data));\n}\nfunction $dc773e5000725a3f$export$ec068583843480e7(field, event, cb) {\n    if (!(field in $dc773e5000725a3f$var$callbacks)) $dc773e5000725a3f$var$callbacks[field] = {};\n    if (!(event in $dc773e5000725a3f$var$callbacks[field])) $dc773e5000725a3f$var$callbacks[field][event] = [];\n    $dc773e5000725a3f$var$callbacks[field][event].push(cb);\n}\nfunction $dc773e5000725a3f$export$2cd8252107eb640b({ tags: tagsList, items: itemsList, periods: periodsList }) {\n    if (tagsList.length > 0) {\n        $dc773e5000725a3f$var$lastId.tags = tagsList[tagsList.length - 1].id;\n        $dc773e5000725a3f$var$state.tags = tagsList;\n        if (itemsList.length > 0) {\n            $dc773e5000725a3f$var$lastId.items = itemsList[itemsList.length - 1].id;\n            $dc773e5000725a3f$var$state.items = itemsList;\n        }\n        if (periodsList.length > 0) {\n            const lastPeriod = periodsList[periodsList.length - 1];\n            $dc773e5000725a3f$var$lastId.periods = lastPeriod.id;\n            $dc773e5000725a3f$var$state.periods = periodsList;\n            $dc773e5000725a3f$var$state.activePeriod = lastPeriod;\n        }\n        $dc773e5000725a3f$var$onChange($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags, $dc773e5000725a3f$export$4bf9923669ad6c63.update, tagsList);\n        $dc773e5000725a3f$var$onChange($dc773e5000725a3f$export$4dbdc8f16fed8a34.items, $dc773e5000725a3f$export$4bf9923669ad6c63.update, itemsList);\n        $dc773e5000725a3f$var$onChange($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods, $dc773e5000725a3f$export$4bf9923669ad6c63.update, periodsList);\n    }\n}\nfunction $dc773e5000725a3f$export$e16d8520af44a096(field, instance) {\n    $dc773e5000725a3f$var$state[field].push(instance);\n    $dc773e5000725a3f$var$onChange(field, $dc773e5000725a3f$export$4bf9923669ad6c63.add, instance);\n}\nfunction $dc773e5000725a3f$export$cd7f480d6b8286c3(field, instance) {\n    $dc773e5000725a3f$var$state[field] = $dc773e5000725a3f$var$state[field].filter((i)=>i.id !== instance.id);\n    $dc773e5000725a3f$var$onChange(field, $dc773e5000725a3f$export$4bf9923669ad6c63.remove, instance);\n}\nfunction $dc773e5000725a3f$export$7c7da73463e50efc(period) {\n    $dc773e5000725a3f$var$state.activePeriod = period;\n    $dc773e5000725a3f$var$onChange($dc773e5000725a3f$export$4dbdc8f16fed8a34.activePeriod, $dc773e5000725a3f$export$4bf9923669ad6c63.update, period);\n}\n\n\n\n\nconst $dbc2f441d42f73ec$export$82babaa65029102d = {\n    items: {\n        list: \"items\",\n        template: \"item-tmpl\",\n        subitemTemplate: \"subitem-tmpl\"\n    },\n    itemForm: {\n        dialog: \"new-item-dialog\",\n        form: \"new-item-form\",\n        addButton: \"add-item\",\n        closeButton: \"close-new-item-dialog\",\n        subitemsList: \"new-item-form-subitems\",\n        tagsSelect: \"tags-select\",\n        addSubitemBtn: \"new-item-add-subitem\",\n        subitemTemplate: \"subitem-form-tmpl\"\n    },\n    tags: {\n        list: \"tags\",\n        template: \"tag-tmpl\",\n        aside: \"tags-sidebar\",\n        toggleListBtn: \"tags-toggle\"\n    },\n    tagForm: {\n        dialog: \"new-tag-dialog\",\n        form: \"new-tag-form\",\n        addButton: \"add-tag\",\n        closeButton: \"close-new-tag-dialog\"\n    },\n    periods: {\n        toggleButton: \"periods-toggle\",\n        startButton: \"start-period\",\n        aside: \"periods-sidebar\",\n        list: \"periods-list\",\n        periodTemplate: \"period-tmpl\"\n    }\n};\nconst $dbc2f441d42f73ec$var$cache = {};\nfunction $dbc2f441d42f73ec$export$d16800b7e59a8051(id) {\n    if ($dbc2f441d42f73ec$var$cache[id]) return $dbc2f441d42f73ec$var$cache[id];\n    const element = document.getElementById(id);\n    $dbc2f441d42f73ec$var$cache[id] = element;\n    return element;\n}\nfunction $dbc2f441d42f73ec$export$9b1a70d8e05b0fa6(id) {\n    const template = $dbc2f441d42f73ec$export$d16800b7e59a8051(id);\n    const $clone = template.content.cloneNode(true);\n    return $clone;\n}\n\n\nconst $a3af35a965fa94a8$var$selectors = {\n    subitem: \".subitem-form\"\n};\nfunction $a3af35a965fa94a8$var$renderSubitemForm() {\n    const $clone = (0, $dbc2f441d42f73ec$export$9b1a70d8e05b0fa6)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.subitemTemplate);\n    const $subitem = $clone.querySelector($a3af35a965fa94a8$var$selectors.subitem);\n    const $subitemSelect = $subitem.querySelector(\"select\");\n    const tags = (0, $dc773e5000725a3f$export$50fdfeece43146fd)((0, $dc773e5000725a3f$export$4dbdc8f16fed8a34).tags);\n    tags.forEach((tag)=>{\n        const $tag = $a3af35a965fa94a8$var$renderTagOption(tag);\n        $subitemSelect.appendChild($tag);\n    });\n    return $subitem;\n}\nfunction $a3af35a965fa94a8$var$renderTagOption(tag) {\n    const $option = document.createElement(\"option\");\n    $option.textContent = tag.name;\n    $option.value = tag.id;\n    return $option;\n}\nfunction $a3af35a965fa94a8$export$a7d31dc4e9b4d21a() {\n    const $tagsSelect = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.tagsSelect);\n    $tagsSelect.innerHTML = \"\";\n    const tags = [\n        ...(0, $dc773e5000725a3f$export$50fdfeece43146fd)((0, $dc773e5000725a3f$export$4dbdc8f16fed8a34).tags)\n    ];\n    const tagsWeight = (0, $dc773e5000725a3f$export$427b5ec03bdd7685)();\n    tags.sort((a, b)=>tagsWeight[b.id] - tagsWeight[a.id]);\n    tags.forEach((tag)=>{\n        const $option = $a3af35a965fa94a8$var$renderTagOption(tag);\n        $tagsSelect.appendChild($option);\n    });\n}\nfunction $a3af35a965fa94a8$var$resetNewItemForm() {\n    const $newItemForm = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.form);\n    const $newItemFormSubitemsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.subitemsList);\n    $newItemForm.reset();\n    $newItemFormSubitemsList.innerHTML = \"\";\n}\nfunction $a3af35a965fa94a8$var$openNewItemForm() {\n    const $newItemDialog = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.dialog);\n    $newItemDialog.showModal();\n}\nfunction $a3af35a965fa94a8$export$2f62053d3c3a3e3e() {\n    const $newItemDialog = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.dialog);\n    $newItemDialog.close();\n    $a3af35a965fa94a8$var$resetNewItemForm();\n}\nfunction $a3af35a965fa94a8$export$a5a4f02b496d762d() {\n    const $newItemForm = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.form);\n    const fd = new FormData($newItemForm);\n    const subitemTexts = fd.getAll(\"subitems[text][]\");\n    const subitemPrices = fd.getAll(\"subitems[price][]\");\n    const subitemTags = fd.getAll(\"subitems[tag][]\");\n    return {\n        text: fd.get(\"text\"),\n        price: fd.get(\"price\"),\n        tag: Number(fd.get(\"tag\")),\n        subitems: subitemTexts.map((text, i)=>{\n            return {\n                text: text,\n                price: subitemPrices[i],\n                tag: Number(subitemTags[i])\n            };\n        })\n    };\n}\nfunction $a3af35a965fa94a8$export$5aaae3b85e8f235d(config) {\n    const { onSubmit: onSubmit } = config;\n    const $newItemForm = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.form);\n    const $addItemButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.addButton);\n    const $closeDialogButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.closeButton);\n    const $addSubitemButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.addSubitemBtn);\n    const $subitemsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).itemForm.subitemsList);\n    $newItemForm.addEventListener(\"submit\", (e)=>{\n        e.preventDefault();\n        onSubmit($a3af35a965fa94a8$export$a5a4f02b496d762d());\n    });\n    $addItemButton.addEventListener(\"click\", ()=>{\n        $a3af35a965fa94a8$var$openNewItemForm();\n    });\n    $closeDialogButton.addEventListener(\"click\", ()=>{\n        $a3af35a965fa94a8$export$2f62053d3c3a3e3e();\n    });\n    $addSubitemButton.addEventListener(\"click\", ()=>{\n        const $subitemForm = $a3af35a965fa94a8$var$renderSubitemForm();\n        $subitemsList.appendChild($subitemForm);\n    });\n}\n\n\n\n\nconst $e2d7e373f74c278f$var$selectors = {\n    item: \".item\",\n    itemText: \".item-text\",\n    itemPrice: \".item-price\",\n    itemTag: \".item-tag\",\n    itemRemove: \".item-remove\",\n    subitems: \".item-subitems\",\n    subitem: \".subitem\",\n    subitemText: \".subitem-text\",\n    subitemPrice: \".subitem-price\",\n    subitemTag: \".subitem-tag\"\n};\nfunction $e2d7e373f74c278f$var$renderSubitem(subitem) {\n    const $clone = (0, $dbc2f441d42f73ec$export$9b1a70d8e05b0fa6)((0, $dbc2f441d42f73ec$export$82babaa65029102d).items.subitemTemplate);\n    const $subitem = $clone.querySelector($e2d7e373f74c278f$var$selectors.subitem);\n    $subitem.querySelector($e2d7e373f74c278f$var$selectors.subitemText).textContent = subitem.text;\n    $subitem.querySelector($e2d7e373f74c278f$var$selectors.subitemPrice).textContent = subitem.price;\n    const tags = (0, $dc773e5000725a3f$export$50fdfeece43146fd)((0, $dc773e5000725a3f$export$4dbdc8f16fed8a34).tags);\n    const subitemTag = tags.find((tag)=>tag.id === subitem.tag);\n    $subitem.querySelector($e2d7e373f74c278f$var$selectors.subitemTag).textContent = subitemTag?.name || \"\";\n    return $subitem;\n}\nfunction $e2d7e373f74c278f$var$renderItem(item) {\n    const $clone = (0, $dbc2f441d42f73ec$export$9b1a70d8e05b0fa6)((0, $dbc2f441d42f73ec$export$82babaa65029102d).items.template);\n    const $item = $clone.querySelector($e2d7e373f74c278f$var$selectors.item);\n    $item.dataset.itemId = item.id;\n    $item.querySelector($e2d7e373f74c278f$var$selectors.itemText).textContent = item.text;\n    $item.querySelector($e2d7e373f74c278f$var$selectors.itemPrice).textContent = item.price;\n    const tags = (0, $dc773e5000725a3f$export$50fdfeece43146fd)((0, $dc773e5000725a3f$export$4dbdc8f16fed8a34).tags);\n    const itemTag = tags.find((tag)=>tag.id === item.tag);\n    $item.querySelector($e2d7e373f74c278f$var$selectors.itemTag).textContent = itemTag?.name || \"\";\n    if (item.subitems?.length > 0) {\n        const $subitemsList = $item.querySelector($e2d7e373f74c278f$var$selectors.subitems);\n        item.subitems.forEach((subitem)=>{\n            const $subitem = $e2d7e373f74c278f$var$renderSubitem(subitem);\n            $subitemsList.appendChild($subitem);\n        });\n    }\n    return $item;\n}\nfunction $e2d7e373f74c278f$export$a073caafba2bf897(items) {\n    const $itemsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).items.list);\n    items.forEach((item)=>{\n        const $item = $e2d7e373f74c278f$var$renderItem(item);\n        $itemsList.appendChild($item);\n    });\n}\nfunction $e2d7e373f74c278f$export$c1a4300032ac0b7e(item) {\n    const $item = $e2d7e373f74c278f$var$renderItem(item);\n    const $itemsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).items.list);\n    $itemsList.appendChild($item);\n}\nfunction $e2d7e373f74c278f$export$557da4bd554f1d64(itemId) {\n    const $element = document.querySelector(`[data-item-id=\"${itemId}\"]`);\n    $element.remove();\n}\nfunction $e2d7e373f74c278f$export$ec6607eeb8c2a5d9(config) {\n    const { onRemove: onRemove } = config;\n    const $itemsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).items.list);\n    $itemsList.addEventListener(\"click\", (e)=>{\n        const $removeButton = e.target.closest($e2d7e373f74c278f$var$selectors.itemRemove);\n        if ($removeButton) {\n            const $tag = e.target.closest($e2d7e373f74c278f$var$selectors.item);\n            onRemove(Number($tag.dataset.itemId));\n        }\n    });\n}\n\n\nfunction $a2ca17f3a961b196$export$3ae94a2503e890a1(date) {\n    return `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;\n}\n\n\n\nconst $5fa51a99f2ab10bf$var$selectors = {\n    period: \".period\",\n    periodStart: \".period-start\",\n    periodEnd: \".period-end\",\n    periodRemove: \".period-remove\"\n};\nfunction $5fa51a99f2ab10bf$var$renderPeriod(period, nextPeriod) {\n    const $clone = (0, $dbc2f441d42f73ec$export$9b1a70d8e05b0fa6)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.periodTemplate);\n    const $period = $clone.querySelector($5fa51a99f2ab10bf$var$selectors.period);\n    $period.dataset.periodId = period.id;\n    const start = new Date(period.createdAt);\n    const end = nextPeriod ? new Date(nextPeriod.createdAt) : null;\n    $period.querySelector($5fa51a99f2ab10bf$var$selectors.periodStart).textContent = `с ${(0, $a2ca17f3a961b196$export$3ae94a2503e890a1)(start)}`;\n    $period.querySelector($5fa51a99f2ab10bf$var$selectors.periodEnd).textContent = end ? `по ${(0, $a2ca17f3a961b196$export$3ae94a2503e890a1)(end)}` : `...`;\n    return $period;\n}\nfunction $5fa51a99f2ab10bf$export$2b2125c41df5d77(periods) {\n    const $periodsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.list);\n    periods.forEach((period, i)=>{\n        const $period = $5fa51a99f2ab10bf$var$renderPeriod(period, periods[i + 1]);\n        $periodsList.appendChild($period);\n    });\n}\nfunction $5fa51a99f2ab10bf$export$3852f45ed1ebb45d(period) {\n    const $periodsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.list);\n    const $period = $5fa51a99f2ab10bf$var$renderPeriod(period);\n    $periodsList.appendChild($period);\n}\nfunction $5fa51a99f2ab10bf$export$27ab5fa15e02a16a(periodId) {}\nfunction $5fa51a99f2ab10bf$export$20db971c1716cf73(config) {\n    const { onStart: onStart, onRemove: onRemove, onSelect: onSelect } = config;\n    const $toggleButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.toggleButton);\n    const $periodsSidebar = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.aside);\n    const $periodsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.list);\n    const $startButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).periods.startButton);\n    $toggleButton.addEventListener(\"click\", ()=>{\n        if ($periodsSidebar.hasAttribute(\"data-open\")) $periodsSidebar.removeAttribute(\"data-open\");\n        else $periodsSidebar.setAttribute(\"data-open\", \"true\");\n    });\n    $periodsList.addEventListener(\"click\", (e)=>{\n        const $removeButton = e.target.closest($5fa51a99f2ab10bf$var$selectors.periodRemove);\n        if ($removeButton) {\n            const $period = e.target.closest($5fa51a99f2ab10bf$var$selectors.period);\n            onRemove(Number($period.dataset.periodId));\n            return;\n        }\n        const $period = e.target.closest($5fa51a99f2ab10bf$var$selectors.period);\n        if ($period) onSelect(Number($period.dataset.periodId));\n    });\n    $startButton.addEventListener(\"click\", onStart);\n}\n\n\n\n\n\nfunction $a751e9f809741cf3$var$resetNewTagForm() {\n    const $newTagForm = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.form);\n    $newTagForm.reset();\n}\nfunction $a751e9f809741cf3$var$openNewTagForm() {\n    const $newTagDialog = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.dialog);\n    $newTagDialog.showModal();\n}\nfunction $a751e9f809741cf3$export$6e142ec7d834c3f8() {\n    const $newTagDialog = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.dialog);\n    $newTagDialog.close();\n    $a751e9f809741cf3$var$resetNewTagForm();\n}\nfunction $a751e9f809741cf3$var$getNewTagFormData() {\n    const $newTagForm = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.form);\n    return {\n        name: $newTagForm.elements.name.value\n    };\n}\nfunction $a751e9f809741cf3$export$5b882f86b632414c(config) {\n    const { onSubmit: onSubmit } = config;\n    const $newTagForm = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.form);\n    const $addTagButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.addButton);\n    const $closeDialogButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tagForm.closeButton);\n    $newTagForm.addEventListener(\"submit\", (e)=>{\n        e.preventDefault();\n        const formData = $a751e9f809741cf3$var$getNewTagFormData();\n        if (!formData.name) {\n            (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Не заполнено поле name\", {\n                formData: formData\n            });\n            return;\n        }\n        const tags = (0, $dc773e5000725a3f$export$50fdfeece43146fd)((0, $dc773e5000725a3f$export$4dbdc8f16fed8a34).tags);\n        const isDouble = tags.some((t)=>t.name === formData.name);\n        if (isDouble) {\n            (0, $3a628accdda08e87$export$740944ffd2f8d33e)(`Тег с именем ${formData.name} уже добавлен`, {\n                formData: formData\n            });\n            return;\n        }\n        onSubmit(formData);\n    });\n    $addTagButton.addEventListener(\"click\", ()=>{\n        $a751e9f809741cf3$var$openNewTagForm();\n    });\n    $closeDialogButton.addEventListener(\"click\", ()=>{\n        $a751e9f809741cf3$export$6e142ec7d834c3f8();\n    });\n}\n\n\n\nconst $24ba0ae5a4ce5a4a$var$selectors = {\n    tag: \".tag\",\n    tagName: \".tag-name\",\n    tagRemove: \".tag-remove\"\n};\nfunction $24ba0ae5a4ce5a4a$var$renderTag(tag) {\n    const $clone = (0, $dbc2f441d42f73ec$export$9b1a70d8e05b0fa6)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tags.template);\n    const $tag = $clone.querySelector($24ba0ae5a4ce5a4a$var$selectors.tag);\n    $tag.dataset.tagId = tag.id;\n    $tag.querySelector($24ba0ae5a4ce5a4a$var$selectors.tagName).textContent = tag.name;\n    return $tag;\n}\nfunction $24ba0ae5a4ce5a4a$export$5153dfacc9e003db(tags) {\n    const $tagsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tags.list);\n    tags.forEach((tag)=>{\n        const $tag = $24ba0ae5a4ce5a4a$var$renderTag(tag);\n        $tagsList.appendChild($tag);\n    });\n}\nfunction $24ba0ae5a4ce5a4a$export$5aae0045fcf71e3a(tag) {\n    const $tagsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tags.list);\n    const $tag = $24ba0ae5a4ce5a4a$var$renderTag(tag);\n    $tagsList.appendChild($tag);\n}\nfunction $24ba0ae5a4ce5a4a$export$400216edc5450072(tagId) {\n    const $element = document.querySelector(`[data-tag-id=\"${tagId}\"]`);\n    $element.remove();\n}\nfunction $24ba0ae5a4ce5a4a$export$68277c4d50aef9d4(config) {\n    const { onRemove: onRemove } = config;\n    const $tagsList = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tags.list);\n    $tagsList.addEventListener(\"click\", (e)=>{\n        const $removeButton = e.target.closest($24ba0ae5a4ce5a4a$var$selectors.tagRemove);\n        if ($removeButton) {\n            const $tag = e.target.closest($24ba0ae5a4ce5a4a$var$selectors.tag);\n            onRemove(Number($tag.dataset.tagId));\n        }\n    });\n    const $tagsToggleButton = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tags.toggleListBtn);\n    const $tagsSidebar = (0, $dbc2f441d42f73ec$export$d16800b7e59a8051)((0, $dbc2f441d42f73ec$export$82babaa65029102d).tags.aside);\n    $tagsToggleButton.addEventListener(\"click\", ()=>{\n        if ($tagsSidebar.hasAttribute(\"data-open\")) $tagsSidebar.removeAttribute(\"data-open\");\n        else $tagsSidebar.setAttribute(\"data-open\", \"true\");\n    });\n}\n\n\n// Subscriptions\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags, $dc773e5000725a3f$export$4bf9923669ad6c63.update, (tags)=>{\n    (0, $24ba0ae5a4ce5a4a$export$5153dfacc9e003db)(tags);\n    (0, $a3af35a965fa94a8$export$a7d31dc4e9b4d21a)();\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags, $dc773e5000725a3f$export$4bf9923669ad6c63.add, (tag)=>{\n    (0, $24ba0ae5a4ce5a4a$export$5aae0045fcf71e3a)(tag);\n    (0, $a751e9f809741cf3$export$6e142ec7d834c3f8)();\n    (0, $a3af35a965fa94a8$export$a7d31dc4e9b4d21a)();\n    (0, $eb7925e53eeaa87b$export$9136620570748e5)(tag);\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags, $dc773e5000725a3f$export$4bf9923669ad6c63.remove, (tag)=>{\n    (0, $24ba0ae5a4ce5a4a$export$400216edc5450072)(tag.id);\n    (0, $a3af35a965fa94a8$export$a7d31dc4e9b4d21a)();\n    (0, $eb7925e53eeaa87b$export$db24519f95b43085)(tag);\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.items, $dc773e5000725a3f$export$4bf9923669ad6c63.update, (items)=>{\n    const periodItems = $dc773e5000725a3f$export$438707edafd83667();\n    (0, $e2d7e373f74c278f$export$a073caafba2bf897)(periodItems);\n    (0, $a3af35a965fa94a8$export$a7d31dc4e9b4d21a)();\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.items, $dc773e5000725a3f$export$4bf9923669ad6c63.add, (item)=>{\n    (0, $e2d7e373f74c278f$export$c1a4300032ac0b7e)(item);\n    (0, $a3af35a965fa94a8$export$2f62053d3c3a3e3e)();\n    (0, $2e1c9c006365a309$export$d9965447fadaae35)(item);\n    (0, $a3af35a965fa94a8$export$a7d31dc4e9b4d21a)();\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.items, $dc773e5000725a3f$export$4bf9923669ad6c63.remove, (item)=>{\n    (0, $e2d7e373f74c278f$export$557da4bd554f1d64)(item.id);\n    (0, $2e1c9c006365a309$export$6d74f2e0bd134e69)(item);\n    (0, $a3af35a965fa94a8$export$a7d31dc4e9b4d21a)();\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods, $dc773e5000725a3f$export$4bf9923669ad6c63.update, (periods)=>{\n    (0, $5fa51a99f2ab10bf$export$2b2125c41df5d77)(periods);\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods, $dc773e5000725a3f$export$4bf9923669ad6c63.add, (period)=>{\n    (0, $5fa51a99f2ab10bf$export$3852f45ed1ebb45d)(period);\n    (0, $93ce6c7c933f1dfc$export$e2a0d46e1b66d1c3)(period);\n});\n$dc773e5000725a3f$export$ec068583843480e7($dc773e5000725a3f$export$4dbdc8f16fed8a34.activePeriod, $dc773e5000725a3f$export$4bf9923669ad6c63.update, (activePeriod)=>{\n    const periodItems = $dc773e5000725a3f$export$438707edafd83667();\n    (0, $e2d7e373f74c278f$export$a073caafba2bf897)(periodItems);\n});\n// Database\n(0, $089dfe9f23c5cbcf$export$28e7436902e0cf8b)().then(({ tags: tags, items: items, periods: periods })=>{\n    $dc773e5000725a3f$export$2cd8252107eb640b({\n        tags: tags,\n        items: items,\n        periods: periods\n    });\n    if (periods.length === 0) {\n        const basePeriod = {\n            id: 0,\n            createdAt: +new Date()\n        };\n        $dc773e5000725a3f$export$e16d8520af44a096($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods, basePeriod);\n    }\n});\n// Init\n(0, $a3af35a965fa94a8$export$5aaae3b85e8f235d)({\n    onSubmit: (formData)=>{\n        const { text: text, price: price, tag: tag, subitems: subitems } = formData;\n        const createdAt = +new Date();\n        const newItem = {\n            id: $dc773e5000725a3f$export$218c8c3169c024d2($dc773e5000725a3f$export$4dbdc8f16fed8a34.items),\n            text: text,\n            price: price,\n            tag: tag,\n            createdAt: createdAt,\n            subitems: subitems.map((subitem)=>{\n                return {\n                    id: $dc773e5000725a3f$export$218c8c3169c024d2($dc773e5000725a3f$export$4dbdc8f16fed8a34.items),\n                    text: subitem.text,\n                    price: subitem.price,\n                    tag: subitem.tag,\n                    createdAt: createdAt\n                };\n            })\n        };\n        $dc773e5000725a3f$export$e16d8520af44a096($dc773e5000725a3f$export$4dbdc8f16fed8a34.items, newItem);\n    }\n});\n(0, $a751e9f809741cf3$export$5b882f86b632414c)({\n    onSubmit: (formData)=>{\n        const { name: name } = formData;\n        const newTag = {\n            id: $dc773e5000725a3f$export$218c8c3169c024d2($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags),\n            name: name,\n            createdAt: +new Date()\n        };\n        $dc773e5000725a3f$export$e16d8520af44a096($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags, newTag);\n    }\n});\n(0, $e2d7e373f74c278f$export$ec6607eeb8c2a5d9)({\n    onRemove: (itemId)=>{\n        const items = $dc773e5000725a3f$export$50fdfeece43146fd($dc773e5000725a3f$export$4dbdc8f16fed8a34.items);\n        const item = items.find((i)=>i.id === itemId);\n        $dc773e5000725a3f$export$cd7f480d6b8286c3($dc773e5000725a3f$export$4dbdc8f16fed8a34.items, item);\n    }\n});\n(0, $24ba0ae5a4ce5a4a$export$68277c4d50aef9d4)({\n    onRemove: (tagId)=>{\n        const tags = $dc773e5000725a3f$export$50fdfeece43146fd($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags);\n        const tag = tags.find((t)=>t.id === tagId);\n        const items = $dc773e5000725a3f$export$50fdfeece43146fd($dc773e5000725a3f$export$4dbdc8f16fed8a34.items);\n        const tagItems = items.some((item)=>{\n            if (item.tag === tag.id) return true;\n            return item.subitems.some((subitem)=>subitem.tag === tag.id);\n        });\n        if (tagItems) {\n            (0, $3a628accdda08e87$export$740944ffd2f8d33e)(\"Тег нельзя удалить\");\n            return;\n        }\n        $dc773e5000725a3f$export$cd7f480d6b8286c3($dc773e5000725a3f$export$4dbdc8f16fed8a34.tags, tag);\n    }\n});\n(0, $5fa51a99f2ab10bf$export$20db971c1716cf73)({\n    onStart: ()=>{\n        const newPeriod = {\n            id: $dc773e5000725a3f$export$218c8c3169c024d2($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods),\n            createdAt: +new Date()\n        };\n        $dc773e5000725a3f$export$e16d8520af44a096($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods, newPeriod);\n    },\n    onRemove: (periodId)=>{\n        const periods = $dc773e5000725a3f$export$50fdfeece43146fd($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods);\n        const period = periods.find((p)=>p.id === periodId);\n        $dc773e5000725a3f$export$cd7f480d6b8286c3($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods, period);\n    },\n    onSelect: (periodId)=>{\n        const periods = $dc773e5000725a3f$export$50fdfeece43146fd($dc773e5000725a3f$export$4dbdc8f16fed8a34.periods);\n        const period = periods.find((p)=>p.id === periodId);\n        $dc773e5000725a3f$export$7c7da73463e50efc(period);\n    }\n});\n\n})();\n//# sourceMappingURL=index.9f8958c3.js.map\n","import { initDB } from \"./js/db\";\nimport { addItemToDb, removeItemFromDb } from \"./js/db/items\";\nimport { addPeriodToDb } from \"./js/db/periods\";\nimport { addTagToDb, removeTagFromDb } from \"./js/db/tags\";\nimport * as state from \"./js/state\";\nimport { notifyError } from \"./js/utils/notifier\";\nimport {\n  closeNewItemForm,\n  initNewItemForm,\n  updateTagsSelect,\n} from \"./js/view/itemForm\";\nimport {\n  addItemToList,\n  initItemsList,\n  removeItemFromList,\n  renderItemsList,\n} from \"./js/view/items\";\nimport {\n  addPeriodToList,\n  initPeriodsList,\n  renderPeriodsList,\n} from \"./js/view/periods\";\nimport { closeNewTagForm, initNewTagForm } from \"./js/view/tagForm\";\nimport {\n  addTagToList,\n  initTagsList,\n  removeTagFromList,\n  renderTagsList,\n} from \"./js/view/tags\";\n\n// Subscriptions\nstate.subscribe(state.fields.tags, state.events.update, (tags) => {\n  renderTagsList(tags);\n  updateTagsSelect();\n});\nstate.subscribe(state.fields.tags, state.events.add, (tag) => {\n  addTagToList(tag);\n  closeNewTagForm();\n  updateTagsSelect();\n  addTagToDb(tag);\n});\nstate.subscribe(state.fields.tags, state.events.remove, (tag) => {\n  removeTagFromList(tag.id);\n  updateTagsSelect();\n  removeTagFromDb(tag);\n});\n\nstate.subscribe(state.fields.items, state.events.update, (items) => {\n  const periodItems = state.getPeriodItems();\n  renderItemsList(periodItems);\n  updateTagsSelect();\n});\nstate.subscribe(state.fields.items, state.events.add, (item) => {\n  addItemToList(item);\n  closeNewItemForm();\n  addItemToDb(item);\n  updateTagsSelect();\n});\nstate.subscribe(state.fields.items, state.events.remove, (item) => {\n  removeItemFromList(item.id);\n  removeItemFromDb(item);\n  updateTagsSelect();\n});\n\nstate.subscribe(state.fields.periods, state.events.update, (periods) => {\n  renderPeriodsList(periods);\n});\nstate.subscribe(state.fields.periods, state.events.add, (period) => {\n  addPeriodToList(period);\n  addPeriodToDb(period);\n});\n\nstate.subscribe(\n  state.fields.activePeriod,\n  state.events.update,\n  (activePeriod) => {\n    const periodItems = state.getPeriodItems();\n    renderItemsList(periodItems);\n  }\n);\n\n// Database\ninitDB().then(({ tags, items, periods }) => {\n  state.init({ tags, items, periods });\n  if (periods.length === 0) {\n    const basePeriod = {\n      id: 0,\n      createdAt: +new Date(),\n    };\n    state.add(state.fields.periods, basePeriod);\n  }\n});\n\n// Init\ninitNewItemForm({\n  onSubmit: (formData) => {\n    const { text, price, tag, subitems } = formData;\n    const createdAt = +new Date();\n\n    const newItem = {\n      id: state.getId(state.fields.items),\n      text,\n      price,\n      tag,\n      createdAt,\n\n      subitems: subitems.map((subitem) => {\n        return {\n          id: state.getId(state.fields.items),\n          text: subitem.text,\n          price: subitem.price,\n          tag: subitem.tag,\n          createdAt,\n        };\n      }),\n    };\n\n    state.add(state.fields.items, newItem);\n  },\n});\ninitNewTagForm({\n  onSubmit: (formData) => {\n    const { name } = formData;\n    const newTag = {\n      id: state.getId(state.fields.tags),\n      name,\n      createdAt: +new Date(),\n    };\n    state.add(state.fields.tags, newTag);\n  },\n});\ninitItemsList({\n  onRemove: (itemId) => {\n    const items = state.getState(state.fields.items);\n    const item = items.find((i) => i.id === itemId);\n    state.remove(state.fields.items, item);\n  },\n});\ninitTagsList({\n  onRemove: (tagId) => {\n    const tags = state.getState(state.fields.tags);\n    const tag = tags.find((t) => t.id === tagId);\n\n    const items = state.getState(state.fields.items);\n\n    const tagItems = items.some((item) => {\n      if (item.tag === tag.id) return true;\n      return item.subitems.some((subitem) => subitem.tag === tag.id);\n    });\n    if (tagItems) {\n      notifyError(\"Тег нельзя удалить\");\n      return;\n    }\n    state.remove(state.fields.tags, tag);\n  },\n});\ninitPeriodsList({\n  onStart: () => {\n    const newPeriod = {\n      id: state.getId(state.fields.periods),\n      createdAt: +new Date(),\n    };\n    state.add(state.fields.periods, newPeriod);\n  },\n  onRemove: (periodId) => {\n    const periods = state.getState(state.fields.periods);\n    const period = periods.find((p) => p.id === periodId);\n    state.remove(state.fields.periods, period);\n  },\n  onSelect: (periodId) => {\n    const periods = state.getState(state.fields.periods);\n    const period = periods.find((p) => p.id === periodId);\n    state.setActivePeriod(period);\n  },\n});\n","import {\n  DB_NAME,\n  DB_VERSION,\n  ITEMS_STORE_NAME,\n  PERIODS_STORE_NAME,\n  TAGS_STORE_NAME,\n} from \"./constants\";\n\nlet dbRequest;\n\nexport function getStore(storeName, toWrite) {\n  let db = dbRequest.result;\n  let transaction = db.transaction(\n    storeName,\n    toWrite ? \"readwrite\" : \"readonly\"\n  );\n  let store = transaction.objectStore(storeName);\n  return store;\n}\n\nfunction getItems() {\n  return new Promise((resolve) => {\n    const items = getStore(ITEMS_STORE_NAME);\n    const request = items.getAll();\n    request.onsuccess = function () {\n      const result = request.result;\n      resolve(result);\n    };\n  });\n}\n\nasync function getTags() {\n  return new Promise((resolve) => {\n    const tags = getStore(TAGS_STORE_NAME);\n    const request = tags.getAll();\n    request.onsuccess = function () {\n      const result = request.result;\n      resolve(result);\n    };\n  });\n}\n\nasync function getPeriods() {\n  return new Promise((resolve) => {\n    const periods = getStore(PERIODS_STORE_NAME);\n    const request = periods.getAll();\n    request.onsuccess = function () {\n      const result = request.result;\n      resolve(result);\n    };\n  });\n}\n\nexport async function initDB() {\n  return new Promise((resolve) => {\n    dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n    dbRequest.onupgradeneeded = function () {\n      let db = dbRequest.result;\n      if (!db.objectStoreNames.contains(ITEMS_STORE_NAME)) {\n        db.createObjectStore(ITEMS_STORE_NAME, { keyPath: \"id\" });\n      }\n      if (!db.objectStoreNames.contains(TAGS_STORE_NAME)) {\n        db.createObjectStore(TAGS_STORE_NAME, { keyPath: \"id\" });\n      }\n      if (!db.objectStoreNames.contains(PERIODS_STORE_NAME)) {\n        db.createObjectStore(PERIODS_STORE_NAME, { keyPath: \"id\" });\n      }\n    };\n    dbRequest.onerror = function () {\n      console.error(\"DB ERROR\", dbRequest.error);\n    };\n    dbRequest.onsuccess = function () {\n      Promise.all([getTags(), getItems(), getPeriods()]).then(\n        ([tags, items, periods]) => {\n          resolve({ tags, items, periods });\n        }\n      );\n    };\n  });\n}\n","export const DB_NAME = \"wallet\";\nexport const DB_VERSION = 4;\nexport const ITEMS_STORE_NAME = \"items\";\nexport const TAGS_STORE_NAME = \"tags\";\nexport const PERIODS_STORE_NAME = \"periods\"\n","import { getStore } from \".\";\nimport { notify, notifyError } from \"../utils/notifier\";\nimport { ITEMS_STORE_NAME } from \"./constants\";\n\nexport function addItemToDb(item) {\n  const items = getStore(ITEMS_STORE_NAME, true);\n  let request = items.add(item);\n  request.onsuccess = function () {\n    notify(\"Запись успешно сохранена\");\n  };\n  request.onerror = function () {\n    notifyError(\"Не удалось сохранить запись\", request.error);\n  };\n}\n\nexport function removeItemFromDb(item) {\n  let items = getStore(ITEMS_STORE_NAME, true);\n  let request = items.delete(item.id);\n  request.onsuccess = function () {\n    notify(\"Запись успешно удалена\");\n  };\n  request.onerror = function () {\n    notifyError(\"Не удалось удалить запись\", request.error);\n  };\n}\n","export function notify(message, data) {\n  alert(message);\n  console.info(message, data);\n}\n\nexport function notifyError(message, data) {\n  alert(message);\n  console.error(message, data);\n}\n","import { getStore } from \".\";\nimport { notify, notifyError } from \"../utils/notifier\";\nimport { PERIODS_STORE_NAME } from \"./constants\";\n\nexport function addPeriodToDb(period) {\n  const periods = getStore(PERIODS_STORE_NAME, true);\n  let request = periods.add(period);\n  request.onsuccess = function () {\n    notify(\"Запись успешно сохранена\");\n  };\n  request.onerror = function () {\n    notifyError(\"Не удалось сохранить запись\", request.error);\n  };\n}\n\nexport function removePeriodFromDb(period) {\n  let periods = getStore(PERIODS_STORE_NAME, true);\n  let request = periods.delete(period.id);\n  request.onsuccess = function () {\n    notify(\"Запись успешно удалена\");\n  };\n  request.onerror = function () {\n    notifyError(\"Не удалось удалить запись\", request.error);\n  };\n}\n","import { getStore } from \".\";\nimport { notify, notifyError } from \"../utils/notifier\";\nimport { TAGS_STORE_NAME } from \"./constants\";\n\nexport function addTagToDb(tag) {\n  let tags = getStore(TAGS_STORE_NAME, true);\n  let request = tags.add(tag);\n  request.onsuccess = function () {\n    notify(\"Запись успешно сохранена\");\n  };\n  request.onerror = function () {\n    notifyError(\"Не удалось сохранить запись\", request.error);\n  };\n}\n\nexport function removeTagFromDb(tag) {\n  let tags = getStore(TAGS_STORE_NAME, true);\n  let request = tags.delete(tag.id);\n  request.onsuccess = function () {\n    notify(\"Запись успешно удалена\");\n  };\n  request.onerror = function () {\n    notifyError(\"Не удалось удалить запись\", request.error);\n  };\n}\n","export const fields = {\n  items: \"items\",\n  tags: \"tags\",\n  periods: \"periods\",\n\n  activePeriod: \"activePeriod\",\n};\n\nexport const events = {\n  update: \"update\",\n  add: \"add\",\n  remove: \"remove\",\n};\n\nconst state = {\n  items: [],\n  tags: [],\n  periods: [],\n\n  activePeriod: null,\n};\n\nconst lastId = {\n  items: 0,\n  tags: 0,\n  periods: 0,\n};\n\nconst callbacks = {};\n\nexport function getState(field) {\n  return state[field];\n}\n\nexport function getPeriodItems() {\n  const period = state.activePeriod;\n  if (!period) {\n    return state.items;\n  }\n\n  const periodIndex = state.periods.findIndex((p) => p.id === period.id);\n  const nextPeriod = state.periods[periodIndex + 1];\n\n  console.log({ period, periodIndex, nextPeriod, periods: state.periods, items: state.items });\n\n  return state.items.filter((item) => {\n    if (item.createdAt < period.createdAt) return false;\n    if (nextPeriod && item.createdAt >= nextPeriod.createdAt) return false;\n    return true;\n  });\n}\n\nexport function getAllItems() {\n  const items = [];\n  state.items.forEach((item) => {\n    items.push(item);\n    items.push(...item.subitems);\n  });\n  return items;\n}\n\nexport function getTagsWeight() {\n  const items = getAllItems();\n  const weight = {};\n  state.tags.forEach((tag) => {\n    weight[tag.id] = 0;\n  });\n  items.forEach((item) => {\n    weight[item.tag] += 1;\n  });\n  return weight;\n}\n\nexport function getId(field) {\n  return ++lastId[field];\n}\n\nfunction onChange(field, event, data) {\n  const fieldCbs = callbacks[field];\n  if (!fieldCbs) return;\n\n  const eventCbs = fieldCbs[event];\n  if (!eventCbs) return;\n\n  eventCbs.forEach((cb) => cb(data));\n}\n\nexport function subscribe(field, event, cb) {\n  if (!(field in callbacks)) callbacks[field] = {};\n  if (!(event in callbacks[field])) callbacks[field][event] = [];\n\n  callbacks[field][event].push(cb);\n}\n\nexport function init({\n  tags: tagsList,\n  items: itemsList,\n  periods: periodsList,\n}) {\n  if (tagsList.length > 0) {\n    lastId.tags = tagsList[tagsList.length - 1].id;\n    state.tags = tagsList;\n\n    if (itemsList.length > 0) {\n      lastId.items = itemsList[itemsList.length - 1].id;\n      state.items = itemsList;\n    }\n\n    if (periodsList.length > 0) {\n      const lastPeriod = periodsList[periodsList.length - 1];\n      lastId.periods = lastPeriod.id;\n      state.periods = periodsList;\n      state.activePeriod = lastPeriod;\n    } \n\n    onChange(fields.tags, events.update, tagsList);\n    onChange(fields.items, events.update, itemsList);\n    onChange(fields.periods, events.update, periodsList);\n  }\n}\n\nexport function add(field, instance) {\n  state[field].push(instance);\n  onChange(field, events.add, instance);\n}\n\nexport function remove(field, instance) {\n  state[field] = state[field].filter((i) => i.id !== instance.id);\n  onChange(field, events.remove, instance);\n}\n\nexport function setActivePeriod(period) {\n  state.activePeriod = period;\n  onChange(fields.activePeriod, events.update, period);\n}\n","import { fields, getState, getTagsWeight } from \"../state\";\nimport { IDS, getElement, getTemplate } from \"./elements\";\n\nconst selectors = {\n  subitem: \".subitem-form\",\n};\n\nfunction renderSubitemForm() {\n  const $clone = getTemplate(IDS.itemForm.subitemTemplate);\n\n  const $subitem = $clone.querySelector(selectors.subitem);\n  const $subitemSelect = $subitem.querySelector(\"select\");\n\n  const tags = getState(fields.tags);\n\n  tags.forEach((tag) => {\n    const $tag = renderTagOption(tag);\n    $subitemSelect.appendChild($tag);\n  });\n\n  return $subitem;\n}\n\nfunction renderTagOption(tag) {\n  const $option = document.createElement(\"option\");\n  $option.textContent = tag.name;\n  $option.value = tag.id;\n  return $option;\n}\n\nexport function updateTagsSelect() {\n  const $tagsSelect = getElement(IDS.itemForm.tagsSelect);\n\n  $tagsSelect.innerHTML = \"\";\n\n  const tags = [...getState(fields.tags)];\n  const tagsWeight = getTagsWeight();\n  tags.sort((a, b) => tagsWeight[b.id] - tagsWeight[a.id]);\n\n  tags.forEach((tag) => {\n    const $option = renderTagOption(tag);\n    $tagsSelect.appendChild($option);\n  });\n}\n\nfunction resetNewItemForm() {\n  const $newItemForm = getElement(IDS.itemForm.form);\n  const $newItemFormSubitemsList = getElement(IDS.itemForm.subitemsList);\n\n  $newItemForm.reset();\n  $newItemFormSubitemsList.innerHTML = \"\";\n}\n\nfunction openNewItemForm() {\n  const $newItemDialog = getElement(IDS.itemForm.dialog);\n  $newItemDialog.showModal();\n}\n\nexport function closeNewItemForm() {\n  const $newItemDialog = getElement(IDS.itemForm.dialog);\n  $newItemDialog.close();\n  resetNewItemForm();\n}\n\nexport function getNewItemFormData() {\n  const $newItemForm = getElement(IDS.itemForm.form);\n\n  const fd = new FormData($newItemForm);\n\n  const subitemTexts = fd.getAll(\"subitems[text][]\");\n  const subitemPrices = fd.getAll(\"subitems[price][]\");\n  const subitemTags = fd.getAll(\"subitems[tag][]\");\n\n  return {\n    text: fd.get(\"text\"),\n    price: fd.get(\"price\"),\n    tag: Number(fd.get(\"tag\")),\n\n    subitems: subitemTexts.map((text, i) => {\n      return {\n        text,\n        price: subitemPrices[i],\n        tag: Number(subitemTags[i]),\n      };\n    }),\n  };\n}\n\nexport function initNewItemForm(config) {\n  const { onSubmit } = config;\n\n  const $newItemForm = getElement(IDS.itemForm.form);\n  const $addItemButton = getElement(IDS.itemForm.addButton);\n  const $closeDialogButton = getElement(IDS.itemForm.closeButton);\n  const $addSubitemButton = getElement(IDS.itemForm.addSubitemBtn);\n  const $subitemsList = getElement(IDS.itemForm.subitemsList);\n\n  $newItemForm.addEventListener(\"submit\", (e) => {\n    e.preventDefault();\n\n    onSubmit(getNewItemFormData());\n  });\n\n  $addItemButton.addEventListener(\"click\", () => {\n    openNewItemForm();\n  });\n\n  $closeDialogButton.addEventListener(\"click\", () => {\n    closeNewItemForm();\n  });\n\n  $addSubitemButton.addEventListener(\"click\", () => {\n    const $subitemForm = renderSubitemForm();\n    $subitemsList.appendChild($subitemForm);\n  });\n}\n","export const IDS = {\n  items: {\n    list: \"items\",\n    template: \"item-tmpl\",\n    subitemTemplate: \"subitem-tmpl\",\n  },\n\n  itemForm: {\n    dialog: \"new-item-dialog\",\n    form: \"new-item-form\",\n    addButton: \"add-item\",\n    closeButton: \"close-new-item-dialog\",\n    subitemsList: \"new-item-form-subitems\",\n    tagsSelect: \"tags-select\",\n    addSubitemBtn: \"new-item-add-subitem\",\n    subitemTemplate: \"subitem-form-tmpl\",\n  },\n\n  tags: {\n    list: \"tags\",\n    template: \"tag-tmpl\",\n    aside: \"tags-sidebar\",\n    toggleListBtn: \"tags-toggle\",\n  },\n\n  tagForm: {\n    dialog: \"new-tag-dialog\",\n    form: \"new-tag-form\",\n    addButton: \"add-tag\",\n    closeButton: \"close-new-tag-dialog\",\n  },\n\n  periods: {\n    toggleButton: 'periods-toggle',\n    startButton: 'start-period',\n    aside: 'periods-sidebar',\n    list: 'periods-list',\n    periodTemplate: 'period-tmpl'\n  }\n};\n\nconst cache = {};\n\nexport function getElement(id) {\n  if (cache[id]) return cache[id];\n\n  const element = document.getElementById(id);\n  cache[id] = element;\n  return element;\n}\n\nexport function getTemplate(id) {\n  const template = getElement(id);\n  const $clone = template.content.cloneNode(true);\n  return $clone;\n}\n","import { fields, getState } from \"../state\";\nimport { IDS, getElement, getTemplate } from \"./elements\";\n\nconst selectors = {\n  item: \".item\",\n  itemText: \".item-text\",\n  itemPrice: \".item-price\",\n  itemTag: \".item-tag\",\n  itemRemove: \".item-remove\",\n\n  subitems: \".item-subitems\",\n\n  subitem: \".subitem\",\n  subitemText: \".subitem-text\",\n  subitemPrice: \".subitem-price\",\n  subitemTag: \".subitem-tag\",\n};\n\nfunction renderSubitem(subitem) {\n  const $clone = getTemplate(IDS.items.subitemTemplate);\n\n  const $subitem = $clone.querySelector(selectors.subitem);\n  $subitem.querySelector(selectors.subitemText).textContent = subitem.text;\n  $subitem.querySelector(selectors.subitemPrice).textContent = subitem.price;\n\n  const tags = getState(fields.tags);\n\n  const subitemTag = tags.find((tag) => tag.id === subitem.tag);\n  $subitem.querySelector(selectors.subitemTag).textContent =\n    subitemTag?.name || \"\";\n\n  return $subitem;\n}\n\nfunction renderItem(item) {\n  const $clone = getTemplate(IDS.items.template);\n\n  const $item = $clone.querySelector(selectors.item);\n  $item.dataset.itemId = item.id;\n  $item.querySelector(selectors.itemText).textContent = item.text;\n  $item.querySelector(selectors.itemPrice).textContent = item.price;\n\n  const tags = getState(fields.tags);\n\n  const itemTag = tags.find((tag) => tag.id === item.tag);\n  $item.querySelector(selectors.itemTag).textContent = itemTag?.name || \"\";\n\n  if (item.subitems?.length > 0) {\n    const $subitemsList = $item.querySelector(selectors.subitems);\n    item.subitems.forEach((subitem) => {\n      const $subitem = renderSubitem(subitem);\n      $subitemsList.appendChild($subitem);\n    });\n  }\n\n  return $item;\n}\n\nexport function renderItemsList(items) {\n  const $itemsList = getElement(IDS.items.list);\n\n  items.forEach((item) => {\n    const $item = renderItem(item);\n    $itemsList.appendChild($item);\n  });\n}\n\nexport function addItemToList(item) {\n  const $item = renderItem(item);\n\n  const $itemsList = getElement(IDS.items.list);\n  $itemsList.appendChild($item);\n}\n\nexport function removeItemFromList(itemId) {\n  const $element = document.querySelector(`[data-item-id=\"${itemId}\"]`);\n  $element.remove();\n}\n\nexport function initItemsList(config) {\n  const { onRemove } = config;\n\n  const $itemsList = getElement(IDS.items.list);\n  $itemsList.addEventListener(\"click\", (e) => {\n    const $removeButton = e.target.closest(selectors.itemRemove);\n    if ($removeButton) {\n      const $tag = e.target.closest(selectors.item);\n      onRemove(Number($tag.dataset.itemId));\n    }\n  });\n}\n","import { formatDate } from \"../utils/date\";\nimport { IDS, getElement, getTemplate } from \"./elements\";\n\nconst selectors = {\n  period: \".period\",\n  periodStart: \".period-start\",\n  periodEnd: \".period-end\",\n  periodRemove: \".period-remove\",\n};\n\nfunction renderPeriod(period, nextPeriod) {\n  const $clone = getTemplate(IDS.periods.periodTemplate);\n\n  const $period = $clone.querySelector(selectors.period);\n  $period.dataset.periodId = period.id;\n\n  const start = new Date(period.createdAt);\n  const end = nextPeriod ? new Date(nextPeriod.createdAt) : null;\n\n  $period.querySelector(selectors.periodStart).textContent = `с ${formatDate(\n    start\n  )}`;\n  $period.querySelector(selectors.periodEnd).textContent = end\n    ? `по ${formatDate(end)}`\n    : `...`;\n\n  return $period;\n}\n\nexport function renderPeriodsList(periods) {\n  const $periodsList = getElement(IDS.periods.list);\n\n  periods.forEach((period, i) => {\n    const $period = renderPeriod(period, periods[i + 1]);\n    $periodsList.appendChild($period);\n  });\n}\n\nexport function addPeriodToList(period) {\n  const $periodsList = getElement(IDS.periods.list);\n  const $period = renderPeriod(period);\n  $periodsList.appendChild($period);\n}\n\nexport function removePeriodFromList(periodId) {}\n\nexport function initPeriodsList(config) {\n  const { onStart, onRemove, onSelect } = config;\n\n  const $toggleButton = getElement(IDS.periods.toggleButton);\n  const $periodsSidebar = getElement(IDS.periods.aside);\n  const $periodsList = getElement(IDS.periods.list);\n  const $startButton = getElement(IDS.periods.startButton);\n\n  $toggleButton.addEventListener(\"click\", () => {\n    if ($periodsSidebar.hasAttribute(\"data-open\")) {\n      $periodsSidebar.removeAttribute(\"data-open\");\n    } else {\n      $periodsSidebar.setAttribute(\"data-open\", \"true\");\n    }\n  });\n\n  $periodsList.addEventListener(\"click\", (e) => {\n    const $removeButton = e.target.closest(selectors.periodRemove);\n    if ($removeButton) {\n      const $period = e.target.closest(selectors.period);\n      onRemove(Number($period.dataset.periodId));\n      return;\n    }\n\n    const $period = e.target.closest(selectors.period);\n    if ($period) {\n      onSelect(Number($period.dataset.periodId));\n    }\n  });\n\n  $startButton.addEventListener(\"click\", onStart);\n}\n","export function formatDate(date) {\n  return `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;\n}\n","import { fields, getState } from \"../state\";\nimport { notifyError } from \"../utils/notifier\";\nimport { IDS, getElement } from \"./elements\";\n\nfunction resetNewTagForm() {\n  const $newTagForm = getElement(IDS.tagForm.form);\n  $newTagForm.reset();\n}\n\nfunction openNewTagForm() {\n  const $newTagDialog = getElement(IDS.tagForm.dialog);\n  $newTagDialog.showModal();\n}\n\nexport function closeNewTagForm() {\n  const $newTagDialog = getElement(IDS.tagForm.dialog);\n  $newTagDialog.close();\n  resetNewTagForm();\n}\n\nfunction getNewTagFormData() {\n  const $newTagForm = getElement(IDS.tagForm.form);\n  return {\n    name: $newTagForm.elements.name.value,\n  };\n}\n\nexport function initNewTagForm(config) {\n  const { onSubmit } = config;\n\n  const $newTagForm = getElement(IDS.tagForm.form);\n  const $addTagButton = getElement(IDS.tagForm.addButton);\n  const $closeDialogButton = getElement(IDS.tagForm.closeButton);\n\n  $newTagForm.addEventListener(\"submit\", (e) => {\n    e.preventDefault();\n\n    const formData = getNewTagFormData()\n    if (!formData.name) {\n        notifyError('Не заполнено поле name', { formData })\n        return \n    }\n\n    const tags = getState(fields.tags)\n\n    const isDouble = tags.some(t => t.name === formData.name);\n\n    if (isDouble) {\n        notifyError(`Тег с именем ${formData.name} уже добавлен`, { formData })\n        return \n    }\n\n    onSubmit(formData);\n  });\n\n  $addTagButton.addEventListener(\"click\", () => {\n    openNewTagForm();\n  });\n\n  $closeDialogButton.addEventListener(\"click\", () => {\n    closeNewTagForm();\n  });\n}\n","import { IDS, getElement, getTemplate } from \"./elements\";\n\nconst selectors = {\n  tag: \".tag\",\n  tagName: \".tag-name\",\n  tagRemove: \".tag-remove\",\n};\n\nfunction renderTag(tag) {\n  const $clone = getTemplate(IDS.tags.template);\n\n  const $tag = $clone.querySelector(selectors.tag);\n  $tag.dataset.tagId = tag.id;\n  $tag.querySelector(selectors.tagName).textContent = tag.name;\n  return $tag;\n}\n\nexport function renderTagsList(tags) {\n  const $tagsList = getElement(IDS.tags.list);\n\n  tags.forEach((tag) => {\n    const $tag = renderTag(tag);\n    $tagsList.appendChild($tag);\n  });\n}\n\nexport function addTagToList(tag) {\n  const $tagsList = getElement(IDS.tags.list);\n\n  const $tag = renderTag(tag);\n  $tagsList.appendChild($tag);\n}\n\nexport function removeTagFromList(tagId) {\n  const $element = document.querySelector(`[data-tag-id=\"${tagId}\"]`);\n  $element.remove();\n}\n\nexport function initTagsList(config) {\n  const { onRemove } = config;\n\n  const $tagsList = getElement(IDS.tags.list);\n  $tagsList.addEventListener(\"click\", (e) => {\n    const $removeButton = e.target.closest(selectors.tagRemove);\n    if ($removeButton) {\n      const $tag = e.target.closest(selectors.tag);\n      onRemove(Number($tag.dataset.tagId));\n    }\n  });\n\n  const $tagsToggleButton = getElement(IDS.tags.toggleListBtn);\n  const $tagsSidebar = getElement(IDS.tags.aside);\n\n  $tagsToggleButton.addEventListener(\"click\", () => {\n    if ($tagsSidebar.hasAttribute(\"data-open\")) {\n      $tagsSidebar.removeAttribute(\"data-open\");\n    } else {\n      $tagsSidebar.setAttribute(\"data-open\", \"true\");\n    }\n  });\n}\n"],"names":["$089dfe9f23c5cbcf$var$dbRequest","$ede44c74e12b5991$export$ecb8b5d0fe61b71e","$ede44c74e12b5991$export$1ccac7a1df77a4d0","$ede44c74e12b5991$export$a0ecdc0caa7bc41f","$089dfe9f23c5cbcf$export$6fec604aa7293d0c","storeName","toWrite","transaction","db","result","objectStore","$089dfe9f23c5cbcf$var$getTags","Promise","resolve","tags","request","getAll","onsuccess","$089dfe9f23c5cbcf$var$getPeriods","periods","$089dfe9f23c5cbcf$export$28e7436902e0cf8b","indexedDB","open","onupgradeneeded","objectStoreNames","contains","createObjectStore","keyPath","onerror","console","error","all","items","then","$3a628accdda08e87$export$5e14cdade93d6f7b","message","data","alert","info","$3a628accdda08e87$export$740944ffd2f8d33e","$dc773e5000725a3f$export$4dbdc8f16fed8a34","activePeriod","$dc773e5000725a3f$export$4bf9923669ad6c63","update","add","remove","$dc773e5000725a3f$var$state","$dc773e5000725a3f$var$lastId","$dc773e5000725a3f$var$callbacks","$dc773e5000725a3f$export$438707edafd83667","period","periodIndex","findIndex","p","id","nextPeriod","log","filter","item","createdAt","$dc773e5000725a3f$var$onChange","field","event","fieldCbs","eventCbs","forEach","cb","$dc773e5000725a3f$export$ec068583843480e7","push","$dc773e5000725a3f$export$e16d8520af44a096","instance","$dc773e5000725a3f$export$cd7f480d6b8286c3","i","$dbc2f441d42f73ec$export$82babaa65029102d","list","template","subitemTemplate","itemForm","dialog","form","addButton","closeButton","subitemsList","tagsSelect","addSubitemBtn","aside","toggleListBtn","tagForm","toggleButton","startButton","periodTemplate","$dbc2f441d42f73ec$var$cache","$dbc2f441d42f73ec$export$d16800b7e59a8051","element","document","getElementById","$dbc2f441d42f73ec$export$9b1a70d8e05b0fa6","$clone","content","cloneNode","$a3af35a965fa94a8$var$renderTagOption","tag","$option","createElement","textContent","name","value","$a3af35a965fa94a8$export$a7d31dc4e9b4d21a","$tagsSelect","innerHTML","tagsWeight","$dc773e5000725a3f$export$15b7d0c192d0aa5d","subitems","weight","sort","a","b","appendChild","$a3af35a965fa94a8$export$2f62053d3c3a3e3e","$newItemDialog","close","$a3af35a965fa94a8$var$resetNewItemForm","$newItemForm","$newItemFormSubitemsList","reset","$e2d7e373f74c278f$var$selectors","itemText","itemPrice","itemTag","itemRemove","subitem","subitemText","subitemPrice","subitemTag","$e2d7e373f74c278f$var$renderItem","$item","querySelector","dataset","itemId","text","price","find","length","$subitemsList","$subitem","$e2d7e373f74c278f$var$renderSubitem","$e2d7e373f74c278f$export$a073caafba2bf897","$itemsList","$a2ca17f3a961b196$export$3ae94a2503e890a1","date","getDate","getMonth","getFullYear","$5fa51a99f2ab10bf$var$selectors","periodStart","periodEnd","periodRemove","$5fa51a99f2ab10bf$var$renderPeriod","$period","periodId","start","Date","end","$a751e9f809741cf3$export$6e142ec7d834c3f8","$newTagDialog","$a751e9f809741cf3$var$resetNewTagForm","$newTagForm","$24ba0ae5a4ce5a4a$var$selectors","tagName","tagRemove","$24ba0ae5a4ce5a4a$var$renderTag","$tag","tagId","$tagsList","$element","delete","periodItems","$periodsList","$dc773e5000725a3f$export$2cd8252107eb640b","tagsList","itemsList","periodsList","lastPeriod","basePeriod","config","onSubmit","$addItemButton","$closeDialogButton","$addSubitemButton","addEventListener","e","preventDefault","$a3af35a965fa94a8$export$a5a4f02b496d762d","fd","FormData","subitemTexts","subitemPrices","subitemTags","get","Number","map","$a3af35a965fa94a8$var$openNewItemForm","showModal","$subitemForm","$a3af35a965fa94a8$var$renderSubitemForm","$subitemSelect","formData","newItem","$addTagButton","$a751e9f809741cf3$var$getNewTagFormData","elements","isDouble","some","t","$a751e9f809741cf3$var$openNewTagForm","newTag","onRemove","$removeButton","target","closest","$tagsToggleButton","$tagsSidebar","hasAttribute","removeAttribute","setAttribute","tagItems","onStart","onSelect","$toggleButton","$periodsSidebar","$startButton","newPeriod"],"version":3,"file":"index.9f8958c3.js.map"}